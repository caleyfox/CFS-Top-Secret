---
title: "Grad Project: Violent Crime in Maryland Since 1975 By County"
author: "Caley Fox Shannon"
date: "11-12-23"
output:
  html_document:
    theme: cerulean
    highlight: pygments
    toc: true
    toc_float:
      collapsed: true
      smooth_scroll: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction 

In this notebook, I will analyse the dataset "Violent Crime & Property Crime by County: 1975 to Present" (https://opendata.maryland.gov/Public-Safety/Violent-Crime-Property-Crime-by-County-1975-to-Pre/jwfa-fdxs). 

## Load libraries

```{r echo=FALSE, message=FALSE}

# Turn off scientific notation. 

options(scipen=999)

# Load libraries. 

library(tidyverse)
library(lubridate)
library(janitor)
library(tidycensus)

```

## Load and Cleaning Data

In this section, describe the source of the data, write a basic data dictionary for data you are working with, and discuss any caveats or issues you discovered working with this data. 

```{r}

# Load required data.

violent_crime_counties <- read_csv("data/violent_crime_counties.csv")

# Clean required data and prepare for analysis if needed. 

violent_crime_counties <- clean_names(violent_crime_counties)

violent_crime_counties <- violent_crime_counties |> 
  rename(breaking_and_entering = b_e)|> 
  rename(motor_vehicle_theft = m_v_theft)|> 
  rename(breaking_and_entering_per_100_000_people = b_e_per_100_000_people)|> 
  rename(motor_vehicle_theft_per_100_000_people = m_v_theft_per_100_000_people)|> 
  rename(breaking_and_entering_rate_percent_change_per_100_000_people = b_e_rate_percent_change_per_100_000_people) |> 
  rename(motor_vehicle_theft_rate_percent_change_per_100_000_people = m_v_theft_rate_percent_change_per_100_000_people) 

```

## Description of Data 

This dataset was compiled from Maryland State Police's annual Uniform Crime Reports. There are 1,104 rows, one per county per year since â€˜75. There are 38 columns: jurisdiction, year, population, columns for types of crime (murder, rape, robbery, aggravated assault, breaking and entering, larceny theft and motor vehicle theft). There are columns that total violent crimes and property theft crimes, as well as calculating per capita rates and percent change per year. The data appears to be very complete, with NA values only found in 1975 for "percent change" columns because it is the first year in the dataset. 

I am looking for trends across the crime categories over time. What types of crime have increased and what has decreased? What has stayed steady? Are there any outlying years that may have an interesting story behind them? Based on these trends, what crimes should Marylanders be most concerned about?

### Look at trends over time in the 7 crime categories. 

**Question** Let's start macro at the state level. How has crime in Maryland risen or fallen in the major categories since 1975? 

**Process** Group by year to see change over time. Summarise the number of reported crimes in the major categories of rape, murder, robbery, aggravated assault, breaking and entering, larceny theft and motor vehicle theft. Create a line graph showing these crime trends over time. 

Okay here I got stuck because I didn't know how to vizualize multiple variables in a line graph. I tried adding a second y= command but that absolutely didn't work. I figured that there's probably a function I don't know that will help me here so I asked ChatGPT: 

"I am working in R and using ggplot to visualize a dataset called trends_in_crime. The columns are year, total_rape,  total_murder, total_robbery,  total_agg_assault, total_breaking_and_entering, total_larceny_theft and total_motor_vehicle_theft.  I want to create a line graph where the x axis is year, the y axis is the count, and there is a line representing each of these columns: total_rape,  total_murder, total_robbery,  total_agg_assault, total_breaking_and_entering,  total_larceny_theft and total_motor_vehicle_theft." 

It told me, "# Assuming your data frame is named 'trends_in_crime'

# Reshape the data into long format
trends_long <- trends_in_crime %>%
  gather(key = "crime_type", value = "count", -year)

# Create a line graph using ggplot2
ggplot(trends_long, aes(x = year, y = count, color = crime_type)) +
  geom_line() +
  labs(title = "Crime Trends Over the Years",
       x = "Year",
       y = "Count",
       color = "Crime Type") +
  theme_minimal()" 
  
So here I learned that the function I needed was gather(key = "crime_type", value = "count", -year). I tweaked ChatGPT's code to meet my needs and that worked. Now I had a dataframe with a column called crime_type that included the types of crimes I wanted to include and a line graph with corresponding lines for those types. After looking at the graph, I went back and wrote a title representative of those findings. I also changed the category names to be capitalized for the sake of the graph aesthetics. 

**Answer** In general, crime in Maryland has trended down for nearly two decades. Most crime types appear to peak in 1980 and again around 1995. As of 2020 (the most recent year in the data), crime appears to be at record lows in almost every category. Rape and murder are consistently the most rare, but in this format it is difficult to tell whether rape and murder are at their lowest or if they're at similar levels to 1975. This probably deserves a closer look. 

Larceny theft continues to be the most prevalent crime, but it has also fallen the most dramatically. There could be an interesting story here: have policing practices around larceny theft changed? Has the definition of this crime changed? Or what factors have lead to a drastic decline in larceny theft over the past two years?  

```{r}

# Create new data frame summarizing the 7 crime categories. 

trends_in_crime <- violent_crime_counties |> 
  group_by(year)|> 
  summarise(
    "Rape" = sum(rape), 
    "Murder" = sum(murder), 
    "Robbery" = sum(robbery), 
    "Aggravated Assault" = sum(agg_assault), 
    "Breaking and Entering" = sum(breaking_and_entering), 
    "Larceny Theft" = sum(larceny_theft), 
    "Motor Vehicle Theft" = sum(motor_vehicle_theft)
  )

trends_in_crime

# Create line graph showing these trends over time. 

trends_in_crime_by_type <- trends_in_crime |>
  gather(key = "crime_type", value = "count", -year)

trends_in_crime_by_type |> 
  ggplot() +
  geom_line(aes(x = year, y = count, color = crime_type)) +
  labs(title = "Maryland Crime Dips to Record Lows",
       x = "Year",
       y = "Count",
       color = "Crime Type") +
  theme_minimal()

trends_in_crime_by_type

```

### Now let's compare violent crime and property crime statewide. 

**Question** How do trends in violent crime compare to property crime in Maryland? 

**Process** 

```{r}

# Create new data frame summarizing violent crime and property crime. 

violent_versus_property <- violent_crime_counties |> 
  group_by(year)|> 
  summarise(
    "Violent Crime" = sum(violent_crime_total), 
    "Property Crime" = sum(property_crime_totals))

#Create a second graph showing violent crime versus property crime. 

violent_versus_property_timeline <- violent_versus_property |>
  gather(key = "crime_type", value = "count", -year)

# Find the year with maximum and minimum values for each crime type

max_years <- violent_versus_property_timeline |>
  group_by(crime_type) |>
  filter(count == max(count)) |>
  select(crime_type, year)

min_years <- violent_versus_property_timeline |>
  group_by(crime_type) |>
  filter(count == min(count)) |>
  select(crime_type, year)

violent_versus_property_timeline %>%
  ggplot() +
  geom_line(aes(x = year, y = count, color = crime_type)) +
  geom_point(data = max_years, aes(x = year, y = "Violent Crime", color = crime_type), shape = 16, size = 3) +
  geom_point(data = min_years, aes(x = year, y = "Violent Crime", color = crime_type), shape = 1, size = 3) +
  annotate("text", x = max_years$year, y = max_years$"Violent Crime", label = "Max", vjust = -1) +
  annotate("text", x = min_years$year, y = min_years$"Violent Crime", label = "Min", vjust = 1) +
  labs(
    title = "Violent and Property Crime Over the Years",
    x = "Year",
    y = "Count",
    color = "Crime Type"
  ) +
  theme_minimal()

```

**Sentence text**: [Paste in sentence to engineer here]

```{r}

violent_crime_by_type <- violent_crime_counties |> 
  group_by(year)|> 
  summarise(
    total_rape = sum(rape), 
    total_murder = sum(murder), 
    total_robbery = sum(robbery), 
    total_agg_assault = sum(agg_assault)
  )

violent_crime_by_type_timeline <- violent_crime_by_type |>
  gather(key = "crime_type", value = "count", -year)
  
violent_crime_by_type_timeline|> 
  ggplot() +
  geom_line(aes(x = year, y = count, color = crime_type)) +
  labs(title = "Violent Crime Over Time",
       x = "Year",
       y = "Count",
       color = "Crime Type") +
  theme_minimal()

```


Do the same for property 

```{r}

property_crime_by_type <- violent_crime_counties |> 
  group_by(year)|> 
  summarise(
    total_breaking_and_entering = sum(breaking_and_entering), 
    total_larceny_theft = sum(larceny_theft), 
    total_motor_vehicle_theft = sum(motor_vehicle_theft)
  )

property_crime_by_type

# Create line graph showing these trends over time. 

property_crime_by_type_timeline <- property_crime_by_type |>
  gather(key = "crime_type", value = "count", -year)

property_crime_by_type_timeline |> 
  ggplot() +
  geom_line(aes(x = year, y = count, color = crime_type)) +
  labs(title = "Property Crime Over Time",
       x = "Year",
       y = "Count",
       color = "Crime Type") +
  theme_minimal()



```


Let's look at just PG County, assuming we are reporting for the sake of UMD students in College Park. 


```{r}

#Create a second graph showing violent crime versus property crime. 

trends_pg <- violent_crime_counties |> 
  filter(jurisdiction == "Prince George's County") |>
  group_by(year)|> 
  summarise(
    total_rape = sum(rape), 
    total_murder = sum(murder), 
    total_robbery = sum(robbery), 
    total_agg_assault = sum(agg_assault), 
    total_breaking_and_entering = sum(breaking_and_entering), 
    total_larceny_theft = sum(larceny_theft), 
    total_motor_vehicle_theft = sum(motor_vehicle_theft)
  )

trends_pg

# Create line graph showing these trends over time. 

trends_pg_timeline <- trends_pg |>
  gather(key = "crime_type", value = "count", -year)

trends_pg_timeline|> 
  ggplot() +
  geom_line(aes(x = year, y = count, color = crime_type)) +
  labs(title = "PG County Crime Trends Over the Years",
       x = "Year",
       y = "Count",
       color = "Crime Type") +
  theme_minimal()

```

### Sentence 3

**Sentence text**: [Paste in sentence to engineer here]

**Analysis summary**: [Write up two to three sentences describing the results of your analysis.  Were you able to confirm the finding? If not, why not?]

```{r}
mvtheft_pg <- violent_crime_counties |> 
  filter(jurisdiction == "Prince George's County") |>
  group_by(year)|> 
  summarise(total_motor_vehicle_theft = sum(motor_vehicle_theft)) |> 
  arrange(total_motor_vehicle_theft)

mvtheft_pg

mvtheft_pg |> 
  ggplot()+ 
  geom_bar(aes(x=year, weight=total_motor_vehicle_theft)) + 
  labs(
    title="Vehicle Theft in Prince George's County at Record Lows 2015-2020",
    x = "Year",
    y = "Motor Vehicle Theft",
    caption = "source: Maryland State Police")

```

### Sentence 4

NOW NEED TO MERGE WITH CENSUS DATA TO DO SOMETHING ELSE WITH THIS ANALYSIS 

```{r}
# Put code to reverse engineer sentence here

# Display results of code below this codeblock

```

### Sentence 5

* **Sentence text**: [Paste in sentence to engineer here]
* **Analysis summary**: [Write up two to three sentences describing the results of your analysis.  Were you able to confirm the finding? If not, why not?]

```{r}
# Put code to reverse engineer sentence here

# Display results of code below this codeblock

```

-30-